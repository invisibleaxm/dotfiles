# Fig pre block. Keep at the top of this file.
[[ -f "$HOME/.fig/shell/zshrc.pre.zsh" ]] && builtin source "$HOME/.fig/shell/zshrc.pre.zsh"
# Path to your oh-my-zsh installation.
export ZSH=$HOME/.oh-my-zsh
# Disabling oh-my-zsh theme
ZSH_THEME=""


zstyle ':omz:update' mode disabled
# update manually with: omz update

#Setting some history options
setopt histignorealldups sharehistory
HISTSIZE=1000
SAVEHIST=1000
HISTFILE=~/.zsh_history


#add python pip folder to path
export LOCAL_BIN=$HOME/.local/bin
export PATH="$PATH:$LOCAL_BIN"
#oh-my-zsh plugins
if [[ `uname` == "Darwin" ]]; then #as we are using fig on mac, we skip some of the completion plugins
  alias dircolors='gdircolors'
  plugins=(
    # vi-mode
    fd
    fzf
    sudo
    zsh-dircolors-solarized
    virtualenv
  )
else #ubuntu section
  export BREW_HOME="/home/linuxbrew/.linuxbrew/bin"
  export PATH="$PATH:$BREW_HOME"
  plugins=(
    vi-mode

    # fd
    # fzf
    # git
    # docker
    # sudo
    # zsh-dircolors-solarized
    starship
    zsh-autocomplete
    zsh-autosuggestions
    # zsh-history-substring-search
    # zsh-syntax-highlighting this is a little bit of a cpu hog, need to research further
    # ubuntu
#    virtualenv
    # fast-syntax-highlighting
  #  colored-man-pages
  #  kubectl
  #  pyenv
#    fzf-zsh-plugin
  )
fi
# fpath+=${ZSH_CUSTOM:-${ZSH:-~/.oh-my-zsh}/custom}/plugins/zsh-completions/src
fpath=( ~/.zsh_autoload_functions "${fpath[@]}" )
source $ZSH/oh-my-zsh.sh
# ========
# exports
# ========
export LANG=en_US.UTF-8 # set preferred language UTF-8
export EDITOR=nvim # Prefered editor
# ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE='fg=white'
ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE='fg=108'
ZSH_AUTOSUGGEST_BUFFER_MAX_SIZE=20
ZSH_AUTOSUGGEST_STRATEGY=(history completion)
ZSH_AUTOSUGGEST_USE_ASYNC=true
#export ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE="fg=#ff00ff,bg=cyan,bold,underline"
#export FZF_PREVIEW_ADVANCED=true



# completion config
# zstyle ':completion:*' file-sort access
# workaround for "do you wish to see all x possibilities" prompt eating input
# zstyle ':completion:*' menu select=long
# fuzzy matching for completions
# zstyle ':completion:*' matcher-list '' 'm:{a-zA-Z}={A-Za-z}' 'r:|[._-]=* r:|=*' 'l:|=* r:|=*'

#zstyle '*:compinit' arguments -D -i -u -C -w
#zstyle ':autocomplete:*complete*:*' insert-unambiguous yes
# zsh-autocomplete config https://github.com/marlonrichert/zsh-autocomplete/blob/main/.zshrc
# zstyle ':autocomplete:*' list-lines 7
# zstyle ':autocomplete:*' widget-style menu-select
# zle -A {.,}history-incremental-search-forward
# zle -A {.,}history-incremental-search-backward
# requires fzf to be installed
# style ':autocomplete:*' fzf-completion yes
# requires z to be installed
# zstyle ':autocomplete:*' recent-dirs zsh-z

# auto complete colors
# zstyle ':completion:*:default' list-colors \
#   "ow=30;43"


# ========
# keybinds
# ========
bindkey -s ^l "^uload_azdevops^M"
bindkey -s ^g "^usshagent^M"
bindkey -s ^w "^uwezterm_sessionizer^M"
bindkey -s ^f "^utmux_sessionizer^M"
bindkey '^ ' autosuggest-accept
bindkey '^j' autosuggest-accept
#Make Tab and ShiftTab cycle completions on the command line
# bindkey '\t' menu-complete "$terminfo[kcbt]" reverse-menu-complete
# bindkey -v #vi mode
# Bindkeys - use sudo showkey -a to get sequences
# Shift-Left / Shift-Right
bindkey "^[[1;2D" backward-word
bindkey "^[[1;2C" forward-word
# Shift-Up / Shift-Down
bindkey "^[[1;2A" beginning-of-line
bindkey "^[[1;2B" end-of-line
#Key bindings for home and end buttons (beggining and end of line)
bindkey '\e[H'    beginning-of-line
bindkey '\e[F'    end-of-line
# override zsh-autocomplete
# bindkey -M menuselect '\r' accept-line
# bindkey '\0' set-mark-command
# bindkey '^ I'   complete-word       # tab          | complete
# bindkey '^ [[Z' autosuggest-accept  # shift + tab  | autosuggest
# bindkey '\t\t' autosuggest-accept
bindkey '\t' menu-select "$terminfo[kcbt]" menu-select
bindkey -M menuselect '\t' menu-complete "$terminfo[kcbt]" reverse-menu-complete
# all Tab widgets
zstyle ':autocomplete:*complete*:*' insert-unambiguous yes
# all history widgets
zstyle ':autocomplete:*history*:*' insert-unambiguous yes
# ^S
zstyle ':autocomplete:menu-search:*' insert-unambiguous yes


# ======
# alias
# ======
alias gitm="git checkout main"
alias kraken='open -na "GitKraken" --args -p "$(git rev-parse --show-toplevel)"'
alias vim=nvim
alias zshconfig="chezmoi edit ~/.zshrc"
alias tmuxconfig="chezmoi edit ~/.tmux.conf"
alias ll="ls -ltra"
alias cls="clear"


# Force re-completion
autoload -U compinit && compinit
autoload -Uz load_azdevops wezterm_sessionizer sshagent tmux_sessionizer

#this would bind ctrl + space to accept the current suggestion.
#i belineve the line below is achieved via the fzf plugin
# [ -f ~/.fzf.zsh ] && source ~/.fzf.zsh

# ================================
# ! source additional config below
# ================================
# [[ -f "$HOME/.fzf/shell/key-bindings.zsh" ]] && builtin source "$HOME/.fzf/shell/key-bindings.zsh"
# [[ -f "$HOME/.fzf/shell/completion.zsh" ]] && builtin source "$HOME/.fzf/shell/completion.zsh"
#Star Ship
eval "$(zoxide init zsh)"
eval "$(thefuck --alias)"
# Fig post block. Keep at the bottom of this file.
# eval "$(starship init zsh)"
[[ -f "$HOME/.fig/shell/zshrc.post.zsh" ]] && builtin source "$HOME/.fig/shell/zshrc.post.zsh"



